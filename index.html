<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incremental Game v0.4</title>

    <style>
        * {
            font-family: "JetBrains Mono";
            font-size: 20px;
        }
    </style>
</head>
<body>
    <p id="points_c">Pontos: 0</p>
    <p id="pointspc_c">Pontos por Clique: +1</p>
    <p id="pointsps_c">Pontos a cada 1 Segundo: +1</p>
    <button id="points_b">Clique para +# Pontos</button>
    <br><br><br>
    <button id="pointspc_b">+# Pontos por Clique</button> <br> <br>
    <button id="pointsps_b">+# Pontos por Segundo ( x Pontos ) [ x ]</button>
    <br><br><br>
    <button id="save_b"><b>Salvar</b> Progresso</button>
    <button id="reset_b"><b>Resetar</b> Progresso</button>
    <p id="save_warning">(Salvamento Automático a cada <b>10</b> Segundos)</p>
    <br>
    <p>Versão <b>0.4</b> - <i>Sistema de Níveis</i></p>
</body>
<script>
    // Variáveis 
    const SAVE_KEY = "mySave";

    const ui = {
        points_counter: document.getElementById("points_c"),
        points_button: document.getElementById("points_b"),

        pointspc_counter: document.getElementById("pointspc_c"),
        pointspc_button: document.getElementById("pointspc_b"),

        pointsps_counter: document.getElementById("pointsps_c"),
        pointsps_button: document.getElementById("pointsps_b"),

        save_button: document.getElementById("save_b"),
        reset_button: document.getElementById("reset_b"),
    }

    const game_l = {
        points: 0,
        points_per_click: 1,
        points_per_second: 0,
        points_per_x_millisecond: 1000,
    }

    const upgrade_l = {
        points_per_click_price: 5,
        points_per_click_level: 1,
        points_per_click_increase: 2.5,
        points_per_click_gain: 1,

        points_per_second_price: 100,
        points_per_second_level: 1,
        points_per_second_increase: 2.75,
        points_per_second_gain: 1,
    }
    // ---

    // Chamada Inicial
    loadGame();
    updateUI();
    // ---

    // Funções Utilitárias
    function formatNumber(n, type = "r"){
        return type === "f" ? Math.floor(n * 100) / 100 : Math.round(n * 100) / 100;
    }
    // ---

    function points_auto_production(){
        game_l.points += game_l.points_per_second;
        updateUI();
    }
    setInterval(points_auto_production, game_l.points_per_x_millisecond);

    // Botões
    function pointsButton(){
        game_l.points += game_l.points_per_click;
        updateUI()
    }

    function pointspcButton(){
        if (game_l.points >= formatNumber(upgrade_l.points_per_click_price, "f")) {
            game_l.points -= formatNumber(upgrade_l.points_per_click_price, "f");
            upgrade_l.points_per_click_price *= upgrade_l.points_per_click_increase;
            upgrade_l.points_per_click_level += 1;
            game_l.points_per_click += upgrade_l.points_per_click_gain;
        }
        updateUI()
    }

    function pointspsButton(){
        if (game_l.points >= formatNumber(upgrade_l.points_per_second_price, "f")) {
            game_l.points -= formatNumber(upgrade_l.points_per_second_price, "f");
            upgrade_l.points_per_second_price *= upgrade_l.points_per_second_increase;
            upgrade_l.points_per_second_level += 1;
            game_l.points_per_second += upgrade_l.points_per_second_gain;
        }
        updateUI()
    }

    function saveButton(){
        saveGame();
    }

    function resetButton(){
        localStorage.removeItem(SAVE_KEY);
        location.reload();
    }
    // ---

    // Interface (Contadores e Botões)
    function updateCounters(){
        ui.points_counter.innerHTML = `Pontos: <b>${formatNumber(game_l.points)}</b>`
        ui.pointspc_counter.innerHTML = `Pontos por Clique: <b>+${game_l.points_per_click} </b>`
        ui.pointsps_counter.innerHTML = `Pontos a cada <b>${game_l.points_per_x_millisecond/1000}</b> Segundo: <b>+${game_l.points_per_second} </b>`
    }

    function updateButtons(){
        let points_b_text = `Clique para +<b>${game_l.points_per_click} </b> Pontos`;
        let pointspc_b_text = `+<b>${upgrade_l.points_per_click_gain} </b> \"Pontos por Clique\" 
        ( ${formatNumber(upgrade_l.points_per_click_price)} Pontos ) [ ${upgrade_l.points_per_click_level} ]`;
        let pointsps_b_text = `+<b>${upgrade_l.points_per_second_gain} </b> \"Pontos por Segundo\" 
        ( ${formatNumber(upgrade_l.points_per_second_price)} Pontos ) [ ${upgrade_l.points_per_second_level} ]`;

        ui.points_button.innerHTML = points_b_text;
        ui.pointspc_button.innerHTML = pointspc_b_text;
        ui.pointsps_button.innerHTML = pointsps_b_text;
    }

    function updateUI(){
        updateCounters();
        updateButtons();
    }
    // ---

    // Funções de Salvamento
    function saveGame(){
        const gameData = {
            game: game_l,
            upgrades: upgrade_l
        };
        localStorage.setItem(SAVE_KEY, JSON.stringify(gameData));
    }

    function loadGame(){
        let save = localStorage.getItem(SAVE_KEY);
        if (save) {
            const parsedData = JSON.parse(save);

            Object.assign(game_l, parsedData.game);
            Object.assign(upgrade_l, parsedData.upgrades);
        }
    }
    // ---

    //Chamadas de Função
    ui.points_button.addEventListener('click', pointsButton)
    ui.pointspc_button.addEventListener('click', pointspcButton)
    ui.pointsps_button.addEventListener('click', pointspsButton)
    ui.save_button.addEventListener('click', saveButton)
    ui.reset_button.addEventListener('click', resetButton)

    setInterval(saveGame, 10000); // 10 segundos
    // ---
</script>
</html>